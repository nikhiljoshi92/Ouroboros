digraph Duplicator {

    node
        [shape=Mrecord width=1.5];

    subgraph cluster_DuplicatorFSM {

        label="DuplicatorFSM";

        //
        // States (Nodes)
        //

        "DuplicatorFSM::Waiting"
            [label="{Waiting}"];

        "DuplicatorFSM::WriteHeader"
            [label="{WriteHeader}"];

        "DuplicatorFSM::WriteBatch"
            [label="{WriteBatch}"];

        "DuplicatorFSM::Closed"
            [label="{Closed}"];

        "%start"
            [label="" shape=circle style=filled fillcolor=black width=0.25];

        //
        // Transitions (Edges)
        //

        "DuplicatorFSM::Waiting" -> "DuplicatorFSM::WriteHeader"
            [label="replicate/\l"];

        "DuplicatorFSM::Waiting" -> "DuplicatorFSM::Closed"
            [label="close/\l"];

        "DuplicatorFSM::WriteHeader" -> "DuplicatorFSM::Closed"
            [label="writeReady/\l"];

        "DuplicatorFSM::WriteHeader" -> "DuplicatorFSM::WriteBatch"
            [label="writeReady/\l"];

        "DuplicatorFSM::WriteHeader" -> "DuplicatorFSM::WriteBatch"
            [label="headerWritten/\l"];

        "DuplicatorFSM::WriteHeader" -> "DuplicatorFSM::Waiting"
            [label="pendingEmpty/\l"];

        "DuplicatorFSM::WriteHeader" -> "DuplicatorFSM::Closed"
            [label="close/\l"];

        "DuplicatorFSM::WriteBatch" -> "DuplicatorFSM::Closed"
            [label="writeReady/\l"];

        "DuplicatorFSM::WriteBatch" -> "DuplicatorFSM::WriteHeader"
            [label="writeReady/\l"];

        "DuplicatorFSM::WriteBatch" -> "DuplicatorFSM::Waiting"
            [label="writeReady/\l"];

        "DuplicatorFSM::WriteBatch" -> "DuplicatorFSM::Waiting"
            [label="batchWritten/\l"];

        "DuplicatorFSM::WriteBatch" -> "DuplicatorFSM::Closed"
            [label="close/\l"];

        "DuplicatorFSM::Closed" -> "DuplicatorFSM::Closed"
            [label="close/\l"];

        "%start" -> "DuplicatorFSM::Waiting"
    }

}
